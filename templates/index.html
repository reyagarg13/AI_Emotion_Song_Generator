<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Music & Lyrics Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ffeb3b;
            --secondary: #000;
            --accent: #ff5722;
            --text-light: #f5f5f5;
            --text-dark: #333;
            --success: #4CAF50;
            --info: #2196F3;
            --warning: #FFC107;
            --danger: #F44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--primary);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        /* Navbar */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 235, 59, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 235, 59, 0.2);
            transition: all 0.3s ease;
        }
        
        .navbar.scrolled {
            padding: 15px 5%;
            background-color: rgba(18, 18, 18, 0.95);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        
        .logo-container:hover .logo-img {
            transform: rotate(360deg);
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: color 0.3s ease;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .mobile-menu-toggle {
            display: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .mobile-menu-toggle:hover {
            transform: scale(1.1);
        }
        /* Main content */
        main {
            padding: 120px 5% 80px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Generator sections */
        .generator-section {
            background-color: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 235, 59, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .generator-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .section-title {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 235, 59, 0.3);
            background-color: rgba(50, 50, 50, 0.7);
            color: var(--text-light);
            font-size: 1rem;
            transition: border 0.3s ease, box-shadow 0.3s ease;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 235, 59, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: var(--secondary);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 235, 59, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(255, 235, 59, 0.1);
            color: var(--primary);
            border: 1px solid rgba(255, 235, 59, 0.3);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 235, 59, 0.2);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--text-dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        /* Results section */
        .result-container {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .lyrics-result {
            white-space: pre-wrap;
            background-color: rgba(40, 40, 40, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 235, 59, 0.2);
            margin-bottom: 20px;
            position: relative;
            line-height: 1.6;
        }
        
        .lyrics-line {
            margin-bottom: 8px;
        }
        
        .lyrics-section {
            margin-bottom: 20px;
        }
        
        .section-label {
            display: inline-block;
            background-color: rgba(255, 87, 34, 0.2);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .audio-player {
            width: 100%;
            margin-top: 20px;
            border-radius: 8px;
            background-color: rgba(40, 40, 40, 0.7);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        /* Status indicators */
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .status-processing {
            background-color: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.3);
            color: var(--text-light);
        }
        
        .status-success {
            background-color: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: var(--text-light);
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: var(--text-light);
        }
        
        .progress-container {
            margin-top: 15px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 235, 59, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Glow effects */
        .glow {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.3;
            z-index: -1;
        }
        
        .glow-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: -150px;
            left: -150px;
        }
        
        .glow-2 {
            width: 400px;
            height: 400px;
            background: var(--accent);
            bottom: -200px;
            right: -200px;
        }
        
        /* New UI Elements */
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .ai-badge {
            background-color: rgba(255, 235, 59, 0.2);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px;
            cursor: pointer;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .slider-container {
            margin-top: 8px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            min-width: 30px;
            text-align: center;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .visualizer {
            width: 100%;
            height: 80px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background-color: var(--primary);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        .tag {
            display: inline-block;
            background-color: rgba(255, 235, 59, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 235, 59, 0.2);
        }
        
        .tag:hover {
            background-color: rgba(255, 235, 59, 0.2);
            transform: translateY(-2px);
        }
        
        .tag.active {
            background-color: var(--primary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .preset-btn {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }
        
        .presets-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            main {
                padding: 100px 5% 60px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Animation for generated content */
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-in {
            animation: slideUp 0.5s ease forwards;
        }
        
        /* Waveform visualizer */
        .waveform {
            width: 100%;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform-bar {
            position: absolute;
            bottom: 0;
            width: 3px;
            background-color: var(--primary);
            border-radius: 2px;
        }
        
        /* Theme toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .theme-icon {
            font-size: 1.2rem;
        }

        /* Tips Section Specific Styles */
        .tips-section {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.8), rgba(30, 30, 30, 0.9));
            border-left: 4px solid var(--accent);
        }
    
        .tips-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
    
        .tip-card {
            background: rgba(50, 50, 50, 0.6);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 235, 59, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
    
        .tip-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 235, 59, 0.3);
        }
    
        .tip-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 12px;
        }
    
        .tip-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 87, 34, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 1.1rem;
        }
    
        .tip-title {
            color: var(--primary);
            font-size: 1.2rem;
            margin: 0;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    
        .tip-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.7;
            font-size: 0.95rem;
        }
    
        .highlight {
            color: var(--primary);
            font-weight: 600;
            background: rgba(255, 235, 59, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
        }
    
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .tips-container {
                grid-template-columns: 1fr;
            }
            
            .tip-card {
                padding: 15px;
            }
        }
    
        /* Animation */
        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    
        .tip-card {
            animation: cardEntrance 0.6s ease-out;
            animation-fill-mode: backwards;
        }
    
        /* Delay animations for each card */
        .tip-card:nth-child(1) { animation-delay: 0.1s; }
        .tip-card:nth-child(2) { animation-delay: 0.2s; }
        .tip-card:nth-child(3) { animation-delay: 0.3s; }
        .tip-card:nth-child(4) { animation-delay: 0.4s; }
        .tip-card:nth-child(5) { animation-delay: 0.5s; }


        /* Improved Chatbot Styles with Better Text Visibility */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: rgba(22, 22, 28, 0.95); /* Darker background for better contrast */
            border-radius: 18px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.35), 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 215, 64, 0.25);
            backdrop-filter: blur(12px);
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .chatbot-container.active {
            display: flex;
            transform: translateY(0);
            opacity: 1;
        }

        .chatbot-header {
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.15), rgba(255, 193, 7, 0.15));
            color: #FFD700; /* Brighter yellow for better visibility */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 235, 59, 0.15);
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .chatbot-close-btn {
            background: none;
            border: none;
            color: #FFD700;
            cursor: pointer;
            font-size: 1.1rem;
            opacity: 0.9; /* Increased from 0.8 for better visibility */
            transition: all 0.2s ease;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-close-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.15);
            transform: rotate(90deg);
        }

        .chatbot-messages {
            flex: 1;
            padding: 18px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
        }

        .chatbot-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 235, 59, 0.3); /* Brighter scrollbar */
            border-radius: 10px;
        }

        .chatbot-welcome {
            background: rgba(40, 40, 45, 0.9); /* Darker background for better contrast */
            padding: 18px;
            border-radius: 14px;
            border: 1px solid rgba(255, 235, 59, 0.25); /* Changed from dashed to solid */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            animation: fadeIn 0.5s ease-out;
        }
        .chatbot-welcome p {
            margin: 10px 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chatbot-welcome ul {
            padding-left: 20px;
            margin: 12px 0;
        }

        .chatbot-welcome li {
            margin-bottom: 10px;
            font-size: 0.95rem; /* Slightly larger font */
            line-height: 1.5;
            position: relative;
            color: #FFD700; /* Brighter yellow for better visibility */
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .chatbot-welcome li::before {
            content: 'â€¢';
            color: #FFD700;
            position: absolute;
            left: -15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.6;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            animation: messageAppear 0.3s forwards;
            /* Critical improvements for text visibility */
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: visible;
            min-width: 60px; /* Ensures small messages have enough width */
            white-space: normal; /* Ensures text wraps properly */
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, rgba(255, 215, 64, 0.3), rgba(255, 165, 0, 0.25));
            border-bottom-right-radius: 4px;
            color: #FFFFFF; /* White text for better contrast */
            border: 1px solid rgba(255, 215, 64, 0.2);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            margin-left: 20%; /* Ensures right alignment with space */
        }

        .bot-message {
            align-self: flex-start;
            background: linear-gradient(135deg, rgba(60, 60, 70, 0.8), rgba(45, 45, 55, 0.8));
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(255, 235, 59, 0.1);
            color: #F0F0F0; /* Light gray text for better visibility */
            margin-right: 20%; /* Ensures left alignment with space */
        }

        .chatbot-input {
            display: flex;
            padding: 16px;
            border-top: 1px solid rgba(255, 235, 59, 0.1);
            background: rgba(25, 25, 35, 0.7);
        }

        .chatbot-input input {
            flex: 1;
            padding: 12px 18px;
            border-radius: 24px;
            border: 1px solid rgba(255, 235, 59, 0.25);
            background: rgba(40, 40, 50, 0.8);
            color: #FFFFFF; /* White text for better contrast */
            outline: none;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        .chatbot-input input:focus {
            border-color: rgba(255, 215, 64, 0.5);
            box-shadow: 0 0 0 2px rgba(255, 215, 64, 0.15);
        }

        .chatbot-input input::placeholder {
            color: rgba(200, 200, 200, 0.7); /* Brighter placeholder text */
        }

        .chatbot-input button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #222;
            border: none;
            border-radius: 50%;
            width: 46px; /* Slightly larger for better tap target */
            height: 46px; /* Slightly larger for better tap target */
            margin-left: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(255, 165, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-feedback {
            margin-top: 5px;
            font-size: 12px;
        }
        
        .feedback-question {
            margin-bottom: 3px;
            color: #666;
        }
        
        .feedback-buttons {
            display: flex;
            gap: 5px;
        }
        
        .feedback-btn {
            background-color: transparent;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 11px;
            cursor: pointer;
        }
        
        .feedback-btn:hover {
            background-color: #f0f0f0;
        }
        
        .feedback-thank-you {
            color: #4a86e8;
        }

        .chatbot-input button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 12px rgba(255, 165, 0, 0.4);
        }

        .chatbot-input button:active {
            transform: scale(0.95);
        }

        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #222;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25), 0 0 0 6px rgba(255, 215, 64, 0.15);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3), 0 0 0 8px rgba(255, 215, 64, 0.2);
        }

        .chatbot-toggle:active {
            transform: scale(0.95);
        }

        /* Improved loading indicator */
        .typing-indicator {
            display: flex;
            padding: 10px 15px;
            align-self: flex-start;
            margin-left: 10px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 215, 64, 0.7);
            border-radius: 50%;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { 
                transform: translateY(0);
                opacity: 0.5;
            }
            30% { 
                transform: translateY(-6px);
                opacity: 1;
            }
        }

        /* Special handling for very short messages */
        .message.short-text {
            min-width: 80px; /* Ensures enough space for short messages */
            text-align: center; /* Centers very short text */
        }

        /* Ensure proper spacing between messages */
        .user-message + .bot-message,
        .bot-message + .user-message {
            margin-top: 10px;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .chatbot-container {
                width: 92%; /* Slightly wider for mobile */
                right: 4%;
                bottom: 80px;
                max-height: 65vh;
            }
            
            .chatbot-toggle {
                width: 56px;
                height: 56px;
            }
            
            /* Improve touch target sizes on mobile */
            .message {
                padding: 14px 18px;
                font-size: 1rem;
            }
            
            .chatbot-input input {
                padding: 14px 18px;
            }
        }

        /* Add a specific class to highlight the current message being typed */
        .message.current-message {
            animation: pulseHighlight 2s infinite;
        }

        @keyframes pulseHighlight {
            0%, 100% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); }
            50% { box-shadow: 0 2px 15px rgba(255, 215, 64, 0.3); }
        }

        /* Add specific HTML attribute for better clarity */
        [data-truncated="false"] {
            max-width: none !important;
            white-space: normal !important;
            overflow: visible !important;
        }

        /* Footer */
        .footer {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 100px 0 30px;
            border-top: 1px solid rgba(255, 235, 59, 0.1);
            position: relative;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 60px;
        }
        
        .footer-section h3 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.5rem;
        }
        
        .footer-section p, .footer-section a {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            display: block;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-section a:hover {
            color: var(--primary);
        }
        
        .social-links {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .social-links a {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .social-links a:hover {
            background-color: var(--primary);
            color: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 235, 59, 0.3);
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }
        /* Enhanced Footer */
        .footer-band {
            position: absolute;
            top: -100px;
            left: 0;
            width: 100%;
            height: 200px;
        }
        
        .footer-instrument {
            position: absolute;
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .footer-instrument:hover {
            transform: scale(1.2);
        }


        



        /* Vocal Result Styles */

        btn-vocal {
            background: linear-gradient(135deg, #ff5722, #ff9800);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-vocal:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.3);
        }

        .vocal-generation-container {
            margin: 20px 0;
            text-align: center;
            padding: 20px;
            background: rgba(255, 87, 34, 0.1);
            border-radius: 10px;
            border: 1px dashed rgba(255, 87, 34, 0.3);
        }
        
        .vocal-hint {
            margin-top: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        #vocal-result-container {
            margin-top: 30px;
            background: rgba(50, 50, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 87, 34, 0.3);
        }
        
        .audio-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        .vocal-waveform {
            height: 60px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin-top: 10px;
            display: flex;
            align-items: flex-end;
            padding: 0 5px;
        }
        
        .vocal-waveform-bar {
            flex: 1;
            background: rgba(255, 87, 34, 0.7);
            margin: 0 1px;
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        #mix-tracks-btn {
            background-color: rgba(76, 175, 80, 0.8);
        }
        
        #mix-tracks-btn:hover {
            background-color: rgba(76, 175, 80, 1);
        }

    </style>
</head>
<body>
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    
    <!-- Navigation bar -->
    <nav>
        <div class="logo-container">
            <div class="logo-img">MG</div>
            <div class="logo-text">Music Generator</div>
        </div>
        <div class="nav-links">
            <a href="{{ url_for('home') }}" class="nav-link active">Home</a>
            <a href="{{ url_for('generate') }}" class="nav-link">Generator</a>
            <a href="{{ url_for('features') }}" class="nav-link">Features</a>
            <a href="#demo" class="nav-link">Demo</a>
            <a href="#testimonials" class="nav-link">Testimonials</a>
            <a href="#contact" class="nav-link">Contact</a>
        </div>
        <div class="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
        </div>
        <div class="theme-toggle" id="theme-toggle">
            <i class="fas fa-moon theme-icon"></i>
            <span>Dark</span>
        </div>
    </nav>
    
    <!-- Main content -->
    <main>
        <!-- Lyrics Generator Section -->
        <section class="generator-section">
            <h2 class="section-title"><i class="fas fa-align-left"></i>AI Lyrics Generator</h2>
            
            <form id="lyrics-generator-form">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="seed">Seed Text (optional)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Provide a few words or phrases to inspire the lyrics</span>
                                </span>
                            </label>
                            <input type="text" id="seed" name="seed" placeholder="e.g. 'summer nights, young love'">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotion">Emotion</label>
                            <select id="emotion" name="emotion">

                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="genre">Genre
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Select a music genre to influence the lyrical style</span>
                                </span>
                            </label>
                            <select id="genre" name="genre">
                                <option value="pop">Pop</option>
                                <option value="rock">Rock</option>
                                <option value="hiphop">Hip Hop</option>
                                <option value="rnb">R&B</option>
                                <option value="country">Country</option>
                                <option value="electronic">Electronic</option>
                                <option value="jazz">Jazz</option>
                                <option value="indie">Indie</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="structure">Song Structure
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Comma separated sections (verse, chorus, bridge, etc.)</span>
                                </span>
                            </label>
                            <input type="text" id="structure" name="structure" placeholder="verse, chorus, verse, chorus, bridge, chorus">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Quick Presets</label>
                    <div class="presets-container">
                        <div class="preset-btn" data-preset="pop">Pop Hit</div>
                        <div class="preset-btn" data-preset="ballad">Power Ballad</div>
                        <div class="preset-btn" data-preset="rap">Rap Song</div>
                        <div class="preset-btn" data-preset="rock">Rock Anthem</div>
                        <div class="preset-btn" data-preset="random">Surprise Me</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rhyme-scheme">Rhyme Scheme (optional)
                        <span class="tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Leave blank for automatic rhyme scheme</span>
                        </span>
                    </label>
                    <input type="text" id="rhyme-scheme" name="rhyme-scheme" placeholder="e.g. AABB or ABAB">
                </div>
                
                <div class="form-group">
                    <label>
                        Advanced Options
                        <span class="toggle-switch">
                            <input type="checkbox" id="advanced-toggle">
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                    
                    <div id="advanced-options" style="display: none; margin-top: 15px;">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="length">Length
                                    <span class="slider-value" id="length-value">Medium</span>
                                </label>
                                <input type="range" min="1" max="3" value="2" class="slider" id="length">
                            </div>
                            <div class="form-col">
                                <label for="complexity">Complexity
                                    <span class="slider-value" id="complexity-value">Balanced</span>
                                </label>
                                <input type="range" min="1" max="3" value="2" class="slider" id="complexity">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Keywords (optional)</label>
                            <div id="keyword-container">
                                <input type="text" id="keyword-input" placeholder="Add keywords to include" style="margin-bottom: 10px;">
                                <div id="keywords-display"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="generate-lyrics-btn">
                    <span id="lyrics-btn-text"><i class="fas fa-magic"></i> Generate Lyrics</span>
                </button>
            </form>
            
            <div class="status" id="lyrics-status"></div>
            
            <div class="result-container" id="lyrics-result-container">
                <h3 class="result-title"><i class="fas fa-file-alt"></i> Generated Lyrics</h3>
                <div class="lyrics-result" id="lyrics-result"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="copy-lyrics-btn">
                        <i class="fas fa-copy"></i> Copy Lyrics
                    </button>
                    <button class="btn btn-secondary" id="use-for-music-btn">
                        <i class="fas fa-music"></i> Use for Music Generation
                    </button>
                    <button class="btn btn-info" id="refine-lyrics-btn">
                        <i class="fas fa-wand-magic-sparkles"></i> Enhance with AI
                    </button>
                </div>
            </div>

            <div class="result-container" id="refined-lyrics-container" style="display: none;">
                <h3 class="result-title"><i class="fas fa-sparkles"></i> Refined Lyrics <span class="ai-badge">AI Enhanced</span></h3>
                <div class="lyrics-result" id="refined-lyrics-result"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="copy-refined-lyrics-btn">
                        <i class="fas fa-copy"></i> Copy Refined Lyrics
                    </button>
                    <button class="btn btn-success" id="use-refined-for-music-btn">
                        <i class="fas fa-music"></i> Use for Music Generation
                    </button>
                    <button class="btn btn-warning" id="compare-lyrics-btn">
                        <i class="fas fa-columns"></i> Compare Versions
                    </button>
                </div>
            </div>
        </section>
        
       <!-- Music Generator Section -->
        <section class="generator-section">
            <h2 class="section-title"><i class="fas fa-music"></i> AI Music Generator</h2>
            
            <form id="music-generator-form">
                <div class="form-group">
                    <label for="lyrics">Lyrics <small>(Use [VERSE], [CHORUS] markers)</small></label>
                    <textarea id="lyrics" name="lyrics" placeholder="Example:&#10;[VERSE]&#10;Your lyrics here...&#10;[CHORUS]&#10;Your chorus here..." required></textarea>
                </div>
                
                <div class="form-group" id="vocal-options" style="display: none;">
                    <label>Vocal Customization</label>
                    <div class="slider-container">
                        <label for="vocal-presence">Vocal Presence <span class="slider-value" id="vocal-presence-value">50%</span></label>
                        <input type="range" min="0" max="100" value="50" class="slider" id="vocal-presence">
                    </div>
                    <div class="slider-container">
                        <label for="vocal-reverb">Reverb <span class="slider-value" id="vocal-reverb-value">30%</span></label>
                        <input type="range" min="0" max="100" value="30" class="slider" id="vocal-reverb">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="generate-music-btn">
                    <i class="fas fa-bolt"></i> <span id="music-btn-text">Generate Music</span>
                </button>
            </form>
            
            <div class="status" id="music-status"></div>
            
            <!-- Music Results -->
            <div class="result-container" id="music-result-container">
                <div class="audio-section">
                    <h3 class="result-title"><i class="fas fa-headphones"></i> Instrumental Track</h3>
                    <div class="waveform" id="waveform"></div>
                    <audio controls class="audio-player" id="audio-player"></audio>
                </div>
                
                <div class="action-buttons">
                    <a class="btn btn-success" id="download-music-btn">
                        <i class="fas fa-download"></i> Download
                    </a>
                    <button class="btn btn-secondary" id="new-music-btn">
                        <i class="fas fa-redo"></i> New Version
                    </button>
                    <button class="btn btn-info" id="remix-btn">
                        <i class="fas fa-random"></i> Remix
                    </button>
                    <button class="btn btn-warning" id="save-project-btn">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-vocal" id="generate-vocals-btn" style="display: none;">
                        <i class="fas fa-microphone"></i> Add Vocals
                    </button>
                </div>

                <div class="vocal-generation-container" id="vocal-generation-container" style="display: none;">
                    <button class="btn btn-vocal" id="generate-vocals-btn">
                        <i class="fas fa-microphone"></i> Generate Vocals for These Lyrics
                    </button>
                    <p class="vocal-hint">Uses the lyrics from above</p>
                </div>

                <!-- Vocal Results - Only shown after vocal generation -->
                <div class="result-container" id="vocal-result-container" style="display: none;">
                    <h3 class="result-title"><i class="fas fa-microphone-alt"></i> Generated Vocals</h3>
                    <audio controls class="audio-player" id="vocal-player"></audio>

                    <div class="audio-container">
                        <div class="waveform" id="vocal-waveform"></div>
                        <audio controls class="audio-player" id="vocal-player"></audio>
                    </div>
                    
                    <div class="action-buttons">
                        <a class="btn btn-secondary" id="download-vocals-btn">
                            <i class="fas fa-download"></i> Download Vocals
                        </a>
                        <button class="btn btn-success" id="mix-tracks-btn">
                            <i class="fas fa-sliders-h"></i> Mix With Music
                        </button>
                        <button class="btn btn-info" id="vocal-settings-btn">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                    </div>
                </div>
            </div>
        </section>


        <section class="generator-section tips-section">
            <h2 class="section-title"><i class="fas fa-lightbulb"></i> Songwriting Tips</h2>
            <div class="tips-container">
                <div class="tip-card">
                    <div class="tip-header">
                        <div class="tip-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <h3 class="tip-title">Structure Your Song</h3>
                    </div>
                    <div class="tip-content">
                        Use clear section markers like <span class="highlight">[VERSE]</span>, <span class="highlight">[CHORUS]</span>, 
                        and <span class="highlight">[BRIDGE]</span> to help the AI understand your song's format.
                    </div>
                </div>
        
                <div class="tip-card">
                    <div class="tip-header">
                        <div class="tip-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 class="tip-title">Evoke Emotion</h3>
                    </div>
                    <div class="tip-content">
                        Focus on specific, concrete details rather than abstract concepts to create more powerful emotional lyrics.
                    </div>
                </div>
        
                <div class="tip-card">
                    <div class="tip-header">
                        <div class="tip-icon">
                            <i class="fas fa-random"></i>
                        </div>
                        <h3 class="tip-title">Experiment Freely</h3>
                    </div>
                    <div class="tip-content">
                        Try unexpected genre and structure combinations to discover unique musical ideas you might not have considered.
                    </div>
                </div>
        
                <div class="tip-card">
                    <div class="tip-header">
                        <div class="tip-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h3 class="tip-title">Enhance with AI</h3>
                    </div>
                    <div class="tip-content">
                        Use our AI refinement tools to polish your lyrics while maintaining your original creative vision.
                    </div>
                </div>
        
                <div class="tip-card">
                    <div class="tip-header">
                        <div class="tip-icon">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <h3 class="tip-title">Vary Your Approach</h3>
                    </div>
                    <div class="tip-content">
                        Experiment with different vocal styles, tempos and instrumentation to find the perfect sound for your song.
                    </div>
                </div>
            </div>
        </section>


        <!-- Add this at the bottom of your body, just before the closing </body> tag -->
        <div class="chatbot-container" id="chatbot-container">
            <div class="chatbot-header">
                <h3><i class="fas fa-robot"></i> Music Assistant</h3>
                <button class="chatbot-close-btn" id="chatbot-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="chatbot-welcome">
                    <p>Hi! I'm your AI music assistant. I can:</p>
                    <ul>
                        <li>Explain features as you use them</li>
                        <li>Suggest improvements to your lyrics</li>
                        <li>Help with song structure</li>
                        <li>Answer music theory questions</li>
                    </ul>
                    <p>What would you like to know?</p>
                </div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chatbot-input" placeholder="Ask about your project...">
                <button id="chatbot-send"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <button class="chatbot-toggle" id="chatbot-toggle">
            <i class="fas fa-robot"></i>
        </button>
    </main>

        <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>MelodyGen</h3>
                    <p>AI-powered music and lyrics generation for creators of all levels.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="#">Home</a>
                    <a href="#generator">Generator</a>
                    <a href="#features">Features</a>
                    <a href="#demo">Demo</a>
                    <a href="#testimonials">Testimonials</a>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <a href="#">Documentation</a>
                    <a href="#">API</a>
                    <a href="#">Tutorials</a>
                    <a href="#">Blog</a>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <a href="mailto:info@melodygen.com">info@melodygen.com</a>
                    <a href="tel:+1234567890">+1 (234) 567-890</a>
                    <p>123 Music Lane, Creative City</p>
                </div>
            </div>
            <div class="footer-instruments">
                <div class="footer-instrument" id="guitar-icon" style="left: 10%; bottom: 20px;">
                    <i class="fas fa-guitar fa-3x"></i>
                </div>
                <div class="footer-instrument" id="drum-icon" style="left: 30%; bottom: 20px;">
                    <i class="fas fa-drum fa-3x"></i>
                </div>
                <div class="footer-instrument" id="piano-icon" style="left: 50%; bottom: 20px;">
                    <i class="fas fa-piano-keyboard fa-3x"></i>
                </div>
                <div class="footer-instrument" id="mic-icon" style="left: 70%; bottom: 20px;">
                    <i class="fas fa-microphone fa-3x"></i>
                </div>
                <div class="footer-instrument" id="headphones-icon" style="left: 90%; bottom: 20px;">
                    <i class="fas fa-headphones fa-3x"></i>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 MelodyGen. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check if models are initialized

            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-theme');
                const icon = this.querySelector('.theme-icon');
                const text = this.querySelector('span');
                
                if (document.body.classList.contains('light-theme')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    text.textContent = 'Light';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    text.textContent = 'Dark';
                }
            });

            // Advanced options toggle
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedOptions = document.getElementById('advanced-options');
            
            advancedToggle.addEventListener('change', function() {
                if (this.checked) {
                    advancedOptions.style.display = 'block';
                } else {
                    advancedOptions.style.display = 'none';
                }
            });
            
            // Slider value displays
            const lengthSlider = document.getElementById('length');
            const lengthValue = document.getElementById('length-value');
            const lengthTexts = ['Short', 'Medium', 'Long'];
            
            lengthSlider.addEventListener('input', function() {
                lengthValue.textContent = lengthTexts[this.value - 1];
            });

            const complexitySlider = document.getElementById('complexity');
            const complexityValue = document.getElementById('complexity-value');
            const complexityTexts = ['Simple', 'Balanced', 'Complex'];
            
            complexitySlider.addEventListener('input', function() {
                complexityValue.textContent = complexityTexts[this.value - 1];
            });

            // Preset buttons
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const preset = this.dataset.preset;
                    
                    // Reset all presets
                    presetButtons.forEach(btn => btn.style.borderColor = 'rgba(255, 255, 255, 0.2)');
                    
                    // Highlight selected preset
                    this.style.borderColor = 'var(--primary)';
                    
                    // Apply preset settings
                    switch(preset) {
                        case 'pop':
                            document.getElementById('genre').value = 'pop';
                            document.getElementById('emotion').value = 'happy';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, bridge, chorus';
                            break;
                        case 'ballad':
                            document.getElementById('genre').value = 'pop';
                            document.getElementById('emotion').value = 'emotional';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, bridge, chorus';
                            break;
                        case 'rap':
                            document.getElementById('genre').value = 'hiphop';
                            document.getElementById('emotion').value = 'energetic';
                            document.getElementById('structure').value = 'verse, verse, chorus, verse, verse, chorus';
                            break;
                        case 'rock':
                            document.getElementById('genre').value = 'rock';
                            document.getElementById('emotion').value = 'angry';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, solo, chorus';
                            break;
                        case 'random':
                            // Randomize settings
                            const genres = ['pop', 'rock', 'hiphop', 'rnb', 'country', 'electronic', 'jazz', 'indie'];
                            const emotions = ['happy', 'sad', 'emotional', 'energetic', 'romantic', 'relaxed', 'angry', 'nostalgic'];
                            const structures = [
                                'verse, chorus, verse, chorus, bridge, chorus',
                                'verse, pre-chorus, chorus, verse, pre-chorus, chorus, bridge, chorus',
                                'intro, verse, chorus, verse, chorus, outro',
                                'verse, verse, chorus, verse, chorus',
                                'chorus, verse, chorus, verse, chorus'
                            ];
                            
                            document.getElementById('genre').value = genres[Math.floor(Math.random() * genres.length)];
                            document.getElementById('emotion').value = emotions[Math.floor(Math.random() * emotions.length)];
                            document.getElementById('structure').value = structures[Math.floor(Math.random() * structures.length)];
                            break;
                    }
                });
            });

            // Audio visualizer
            function createWaveform() {
                const waveform = document.getElementById('waveform');
                waveform.innerHTML = '';
                
                for (let i = 0; i < 100; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'waveform-bar';
                    bar.style.left = `${i}%`;
                    bar.style.height = `${Math.random() * 60 + 20}%`;
                    waveform.appendChild(bar);
                }
            }
            
            createWaveform();

            checkModelsStatus();
            
            // Lyrics Generation Form
            const lyricsForm = document.getElementById('lyrics-generator-form');
            const lyricsResult = document.getElementById('lyrics-result');
            const refinedLyricsResult = document.getElementById('refined-lyrics-result');
            const lyricsResultContainer = document.getElementById('lyrics-result-container');
            const refinedLyricsContainer = document.getElementById('refined-lyrics-container');
            const lyricsStatus = document.getElementById('lyrics-status');
            const generateLyricsBtn = document.getElementById('generate-lyrics-btn');
            const lyricsBtnText = document.getElementById('lyrics-btn-text');
            const refineLyricsBtn = document.getElementById('refine-lyrics-btn');
            const compareLyricsBtn = document.getElementById('compare-lyrics-btn');

            // Modify your existing lyrics form submission handler
            lyricsForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log("Form submitted"); // Debug log
                
                // Reset UI
                lyricsResultContainer.style.display = 'none';
                refinedLyricsContainer.style.display = 'none';
                lyricsStatus.style.display = 'none';
                
                // Show loading state
                generateLyricsBtn.disabled = true;
                lyricsBtnText.innerHTML = '<span class="spinner"></span> Generating...';
                console.log("UI reset and loading state shown"); // Debug log
                
                try {
                    console.log("Making API request..."); // Debug log
                    const response = await fetch('/generate_lyrics', {
                        method: 'POST',
                        body: new FormData(lyricsForm),

                    });
                    
                    console.log("Response received:", response); // Debug log
                    const data = await response.json();
                    console.log("Response data:", data); // Debug log
                    
                    if (data.success) {
                        console.log("Success - displaying lyrics"); // Debug log
                        lyricsResult.textContent = data.initial_lyrics;
                        refinedLyricsResult.textContent = data.refined_lyrics;
                        
                        lyricsResultContainer.style.display = 'block';
                        refinedLyricsContainer.style.display = 'block';
                        
                        lyricsStatus.textContent = 'Lyrics generated and enhanced with AI!';
                        lyricsStatus.className = 'status status-success';
                        lyricsStatus.style.display = 'block';
                    } else {
                        console.log("Error from server:", data.error); // Debug log
                        lyricsStatus.textContent = data.error || 'Error generating lyrics';
                        lyricsStatus.className = 'status status-error';
                        lyricsStatus.style.display = 'block';
                    }
                } catch (error) {
                    console.error("Fetch error:", error); // Debug log
                    lyricsStatus.textContent = 'Error connecting to server';
                    lyricsStatus.className = 'status status-error';
                    lyricsStatus.style.display = 'block';
                } finally {
                    generateLyricsBtn.disabled = false;
                    lyricsBtnText.innerHTML = '<i class="fas fa-magic"></i> Generate Lyrics';
                    console.log("Request completed"); // Debug log
                }
            });

            // Function to display lyrics with section formatting
            function displayLyrics(lyrics, element) {
                // Split lyrics into sections
                const sections = lyrics.split(/(\[[A-Z]+\])/g);
                let html = '';
                
                for (let i = 0; i < sections.length; i++) {
                    const section = sections[i].trim();
                    if (!section) continue;
                    
                    if (section.startsWith('[') && section.endsWith(']')) {
                        // It's a section header
                        html += `<div class="lyrics-section"><span class="section-label">${section}</span>`;
                    } else {
                        // It's the content of a section
                        const lines = section.split('\n').filter(line => line.trim() !== '');
                        lines.forEach(line => {
                            html += `<div class="lyrics-line">${line}</div>`;
                        });
                        html += '</div>';
                    }
                }
                
                element.innerHTML = html;
                element.classList.add('animate-in');
            }

            // Compare lyrics button
            compareLyricsBtn.addEventListener('click', function() {
                // Create a comparison view
                const comparisonHTML = `
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;">Original Version</h4>
                            ${lyricsResult.innerHTML}
                        </div>
                        <div style="flex: 1;">
                            <h4 style="color: var(--accent); margin-bottom: 10px;">Enhanced Version</h4>
                            ${refinedLyricsResult.innerHTML}
                        </div>
                    </div>
                `;
                
                // Replace content with comparison
                refinedLyricsResult.innerHTML = comparisonHTML;
            });

            // Copy lyrics button
            document.getElementById('copy-lyrics-btn').addEventListener('click', function() {
                navigator.clipboard.writeText(lyricsResult.textContent).then(() => {
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                });
            });
                        // Copy refined lyrics button
            document.getElementById('copy-refined-lyrics-btn').addEventListener('click', function() {
                navigator.clipboard.writeText(refinedLyricsResult.textContent).then(() => {
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Refined lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                });
            });

            // Use lyrics for music generation button
            document.getElementById('use-for-music-btn').addEventListener('click', function() {
                document.getElementById('lyrics').value = lyricsResult.textContent;
                
                // Scroll to music generator section
                document.querySelector('#music-generator-form').scrollIntoView({
                    behavior: 'smooth'
                });
            });
            
            // Add these event listeners after your existing code
            document.getElementById('copy-refined-lyrics-btn').addEventListener('click', function() {
                // Get the refined lyrics text
                const refinedLyrics = document.getElementById('refined-lyrics-result').textContent;
                
                // Copy to clipboard
                navigator.clipboard.writeText(refinedLyrics).then(() => {
                    // Show success message
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Refined lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                }).catch(err => {
                    console.error('Failed to copy lyrics: ', err);
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Failed to copy lyrics';
                    status.className = 'status status-error';
                    status.style.display = 'block';
                });
            });

            document.getElementById('use-refined-for-music-btn').addEventListener('click', function() {
                // Get the refined lyrics text
                const refinedLyrics = document.getElementById('refined-lyrics-result').textContent;
                
                // Set the lyrics in the music generator textarea
                document.getElementById('lyrics').value = refinedLyrics;
                
                // Scroll to the music generator section smoothly
                document.querySelector('#music-generator-form').scrollIntoView({
                    behavior: 'smooth'
                });
                
                // Show success message
                const status = document.getElementById('lyrics-status');
                status.textContent = 'Refined lyrics loaded into music generator!';
                status.className = 'status status-success';
                status.style.display = 'block';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            });

            // Music Generation Form
            const musicForm = document.getElementById('music-generator-form');
            const musicResultContainer = document.getElementById('music-result-container');
            const audioPlayer = document.getElementById('audio-player');
            const musicStatus = document.getElementById('music-status');
            const generateMusicBtn = document.getElementById('generate-music-btn');
            const musicBtnText = document.getElementById('music-btn-text');
            const downloadMusicBtn = document.getElementById('download-music-btn');
            const newMusicBtn = document.getElementById('new-music-btn');
            
            let musicJobId = null;
            let statusCheckInterval = null;
            
            musicForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Reset UI
                musicResultContainer.style.display = 'none';
                musicStatus.style.display = 'none';
                
                // Show loading state
                generateMusicBtn.disabled = true;
                musicBtnText.innerHTML = '<span class="spinner"></span> Generating...';
                
                // Get form data
                const formData = new FormData(musicForm);
                
                try {
                    // Send request to server
                    const response = await fetch('/generate_music', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Store job ID
                    musicJobId = data.job_id;
                    
                    // Show processing status
                    musicStatus.innerHTML = `
                        <div>Processing your music... This may take a minute.</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="music-progress-bar"></div>
                        </div>
                    `;
                    musicStatus.className = 'status status-processing';
                    musicStatus.style.display = 'block';
                    
                    // Start checking status
                    startMusicStatusCheck();
                } catch (error) {
                    musicStatus.textContent = error.message || 'Error starting music generation';
                    musicStatus.className = 'status status-error';
                    musicStatus.style.display = 'block';
                    
                    // Reset button state
                    generateMusicBtn.disabled = false;
                    musicBtnText.textContent = 'Generate Music';
                }
            });
            
            // Save project button
            document.getElementById('save-project-btn').addEventListener('click', function() {
                const lyrics = document.getElementById('lyrics').value;
                const musicUrl = audioPlayer.src;
                
                if (!lyrics.trim() || !musicUrl) {
                    musicStatus.textContent = 'Nothing to save - generate music first';
                    musicStatus.className = 'status status-error';
                    musicStatus.style.display = 'block';
                    return;
                }
                
                // Create a blob with project data
                const projectData = {
                    lyrics: lyrics,
                    musicUrl: musicUrl,
                    settings: {
                        genre: document.getElementById('music-genre').value,
                        vocalStyle: document.getElementById('vocal-style').value,
                        tempo: tempoSlider.value,
                        intensity: intensitySlider.value,
                        instruments: Array.from(document.querySelectorAll('#instrument-tags .tag.active:not([data-instrument="all"])'))
                            .map(tag => tag.dataset.instrument)
                    },
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create download link
                const a = document.createElement('a');
                a.href = url;
                a.download = `music_project_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show success message
                musicStatus.textContent = 'Project saved successfully!';
                musicStatus.className = 'status status-success';
                musicStatus.style.display = 'block';
            });
            
            function startMusicStatusCheck() {
                if (statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                }
                
                statusCheckInterval = setInterval(async () => {
                    if (!musicJobId) {
                        clearInterval(statusCheckInterval);
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/music_status/${musicJobId}`);
                        const data = await response.json();
                        
                        // Update progress
                        const progressBar = document.getElementById('music-progress-bar');
                        if (progressBar) {
                            progressBar.style.width = `${data.progress}%`;
                        }
                        
                        if (data.status === 'completed') {
                            // Generation complete
                            clearInterval(statusCheckInterval);
                            
                            // Set audio source
                            audioPlayer.src = data.download_url;
                            
                            // Set download link
                            downloadMusicBtn.href = data.download_url;
                            downloadMusicBtn.download = `generated_music_${musicJobId}.wav`;
                            
                            // Show results
                            musicResultContainer.style.display = 'block';
                            
                            // Update status
                            musicStatus.textContent = 'Music generated successfully!';
                            musicStatus.className = 'status status-success';
                            
                            // Reset button state
                            generateMusicBtn.disabled = false;
                            musicBtnText.textContent = 'Generate Music';
                        } else if (data.status === 'failed') {
                            // Generation failed
                            clearInterval(statusCheckInterval);
                            
                            musicStatus.textContent = data.error || 'Music generation failed';
                            musicStatus.className = 'status status-error';
                            
                            // Reset button state
                            generateMusicBtn.disabled = false;
                            musicBtnText.textContent = 'Generate Music';
                        }
                    } catch (error) {
                        console.error('Error checking status:', error);
                    }
                }, 2000); // Check every 2 seconds
            }
            
            // New music button
            newMusicBtn.addEventListener('click', function() {
                musicForm.reset();
                musicResultContainer.style.display = 'none';
                musicStatus.style.display = 'none';
            });
            
            // Check if models are initialized
            async function checkModelsStatus() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    
                    if (!data.lyrics_model_initialized) {
                        showAlert('Lyrics model not initialized. Some features may not work.', 'error');
                    }
                    
                    if (!data.music_generation_ready) {
                        showAlert('Music generation not ready. Some features may not work.', 'error');
                    }
                    
                    // Populate emotions if available
                    if (data.emotions && data.emotions.length > 0) {
                        const emotionSelect = document.getElementById('emotion');
                        emotionSelect.innerHTML = '';
                        
                        data.emotions.forEach(emotion => {
                            const option = document.createElement('option');
                            option.value = emotion;
                            option.textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
                            emotionSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error checking models status:', error);
                }
            }
            
            function showAlert(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `status status-${type}`;
                alertDiv.textContent = message;
                alertDiv.style.marginTop = '20px';
                document.querySelector('main').prepend(alertDiv);
                
                // Remove after 5 seconds
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        });



        // Make sure the DOM is fully loaded before attaching event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Chatbot UI Toggle
            const chatbotContainer = document.getElementById('chatbot-container');
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotCloseBtn = document.getElementById('chatbot-close-btn');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotSendBtn = document.getElementById('chatbot-send');
            
            // Fix 1: Ensure toggle button works
            if (chatbotToggle) {
                chatbotToggle.addEventListener('click', function() {
                    console.log('Toggle clicked');
                    if (chatbotContainer) {
                        chatbotContainer.classList.toggle('active');
                    }
                });
            } else {
                console.error('Chatbot toggle button not found');
            }
            
            // Fix 2: Ensure close button works
            if (chatbotCloseBtn) {
                chatbotCloseBtn.addEventListener('click', function() {
                    console.log('Close clicked');
                    if (chatbotContainer) {
                        chatbotContainer.classList.remove('active');
                    }
                });
            } else {
                console.error('Chatbot close button not found');
            }
            
            // Setup event listeners for sending messages
            if (chatbotInput && chatbotSendBtn) {
                // Send message on button click
                chatbotSendBtn.addEventListener('click', sendMessage);
                
                // Send message on Enter key
                chatbotInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Variables to maintain state
            let sessionId = localStorage.getItem('chatSessionId') || generateSessionId();
            let pendingResponseId = null;
            let currentContext = {};
            let recentMessages = [];
                    
            // Store session ID
            localStorage.setItem('chatSessionId', sessionId);
            
            // Send message to backend
            async function sendMessage() {
                const chatMessages = document.getElementById('chatbot-messages');
                
                const message = chatbotInput.value.trim();
                if (!message) return;
                
                // Clear input and add user message to chat
                chatbotInput.value = '';
                addMessage(message, true);
                
                // Show typing indicator
                const typingIndicator = showTypingIndicator();
                
                try {
                    // Get current context data from the page
                    // This should be adjusted based on your actual page structure
                    currentContext = gatherContextFromPage();
                    
                    // Make API call to backend
                    const response = await fetch('/chatbot', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            session_id: sessionId,
                            context: currentContext
                        })
                    });
                    
                    // Hide typing indicator
                    removeTypingIndicator(typingIndicator);
                    
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    const data = await response.json();
                    
                    // Store the response ID for potential feedback
                    pendingResponseId = data.response_id;
                    
                    // Update session history
                    recentMessages.push({
                        user_message: message,
                        response: data.response,
                        response_id: data.response_id
                    });
                    
                    // Keep only last 5 messages for context
                    if (recentMessages.length > 5) {
                        recentMessages.shift();
                    }
                    
                    // Add bot message to chat
                    const messageElement = addMessage(data.response, false);
                    
                    // Add feedback buttons
                    addFeedbackButtons(messageElement, data.response_id);
                    
                    // Handle any actions returned by the RAG system
                    if (data.action) {
                        handleAction(data.action);
                    }
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    removeTypingIndicator(typingIndicator);
                    
                    // Add error message
                    addMessage("Sorry, I'm having trouble connecting to the server. Please try again later.", false);
                }
            }
            
            // Gather context from the current page state
            function gatherContextFromPage() {
                // Example - modify based on your actual page structure
                let context = {
                    currentTab: document.querySelector('.active-tab')?.dataset?.tab || 'chat',
                    hasMusic: !!document.querySelector('#audio-player')?.src,
                    lyrics: document.querySelector('#lyrics-editor')?.value || ''
                };
                
                // Add any additional context from the page
                return context;
            }
            
            // Handle actions returned by the RAG system
            function handleAction(action) {
                if (typeof action === 'string') {
                    // Simple string actions
                    switch(action) {
                        case 'play_music':
                            const audioPlayer = document.querySelector('#audio-player');
                            if (audioPlayer && audioPlayer.src) {
                                audioPlayer.play();
                            }
                            break;
                            
                        case 'generate_lyrics':
                            // Trigger lyrics generation UI
                            const lyricsBtn = document.querySelector('#generate-lyrics-btn');
                            if (lyricsBtn) {
                                lyricsBtn.click();
                            }
                            break;
                            
                        case 'generate_content':
                            // Trigger content generation UI
                            const generateBtn = document.querySelector('#generate-music-btn');
                            if (generateBtn) {
                                generateBtn.click();
                            }
                            break;
                    }
                } else if (typeof action === 'object') {
                    // Complex action objects
                    switch(action.type) {
                        case 'set_tempo':
                            const tempoInput = document.querySelector('#tempo-input');
                            if (tempoInput && action.value) {
                                tempoInput.value = action.value;
                                // Trigger change event
                                tempoInput.dispatchEvent(new Event('change'));
                            }
                            break;
                            
                        case 'suggest_genre_change':
                            // Highlight the genre selector
                            const genreSelector = document.querySelector('#genre-selector');
                            if (genreSelector) {
                                genreSelector.classList.add('highlight-suggestion');
                                setTimeout(() => {
                                    genreSelector.classList.remove('highlight-suggestion');
                                }, 3000);
                            }
                            break;
                    }
                }
            }
            
            // Add message to chat container
            function addMessage(text, isUser) {
                const chatMessages = document.getElementById('chatbot-messages');
                if (!chatMessages) return null;
                
                // Create message element
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                
                // Set content
                messageDiv.textContent = text;
                
                // Add to container
                chatMessages.appendChild(messageDiv);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Return the element for further manipulation
                return messageDiv;
            }
            
            // Show typing indicator
            function showTypingIndicator() {
                const chatMessages = document.getElementById('chatbot-messages');
                if (!chatMessages) return null;
                
                // Create typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                
                // Add to container
                chatMessages.appendChild(typingDiv);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return typingDiv;
            }
            
            // Remove typing indicator
            function removeTypingIndicator(indicator) {
                if (indicator && indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }
            
            // Add feedback buttons to a message
            function addFeedbackButtons(messageElement, responseId) {
                if (!messageElement) return;
                
                // Add a feedback container to the message
                const feedbackContainer = document.createElement('div');
                feedbackContainer.className = 'message-feedback';
                messageElement.appendChild(feedbackContainer);
                
                // Create feedback buttons
                feedbackContainer.innerHTML = `
                    <div class="feedback-question">Was this response helpful?</div>
                    <div class="feedback-buttons">
                        <button class="feedback-btn" data-rating="5">ðŸ‘ Yes</button>
                        <button class="feedback-btn" data-rating="1">ðŸ‘Ž No</button>
                    </div>
                `;
                
                // Add event listeners
                feedbackContainer.querySelectorAll('.feedback-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const rating = parseInt(this.getAttribute('data-rating'));
                        
                        try {
                            // Send feedback to backend
                            const response = await fetch('/feedback', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    response_id: responseId,
                                    rating: rating,
                                    session_id: sessionId
                                })
                            });
                            
                            if (!response.ok) {
                                throw new Error('Failed to send feedback');
                            }
                            
                            console.log(`Feedback sent successfully: ${rating}`);
                            
                        } catch (error) {
                            console.error('Error sending feedback:', error);
                        }
                        
                        // Update UI regardless of API success
                        feedbackContainer.innerHTML = `
                            <div class="feedback-thank-you">Thanks for your feedback!</div>
                        `;
                        
                        // Hide after delay
                        setTimeout(() => {
                            feedbackContainer.style.display = 'none';
                        }, 3000);
                    });
                });
            }
            
            // Check for context and suggest help
            async function analyzeContextAndSuggest() {
                // Only suggest if we have some context to work with
                if (Object.keys(currentContext).length > 0) {
                    try {
                        const response = await fetch('/chatbot/analyze-context', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                context: currentContext
                            })
                        });
                        
                        if (!response.ok) {
                            return;
                        }
                        
                        const data = await response.json();
                        
                        if (data.suggestions) {
                            // Add a suggestion message after a delay
                            setTimeout(() => {
                                const chatMessages = document.getElementById('chatbot-messages');
                                if (chatMessages && chatMessages.childElementCount < 3) {
                                    addMessage(data.suggestions, false);
                                }
                            }, 15000); // 15-second delay before showing a suggestion
                        }
                        
                    } catch (error) {
                        console.error('Error getting context suggestions:', error);
                    }
                }
            }
            
            // Periodically analyze context when the chatbot is open
            setInterval(() => {
                if (chatbotContainer && chatbotContainer.classList.contains('active')) {
                    analyzeContextAndSuggest();
                }
            }, 60000); // Check every minute
            
            // Utility: Generate session ID
            function generateSessionId() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            
            // Initial context check
            setTimeout(analyzeContextAndSuggest, 5000);
        });

        // Utility: Debounce function
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }



        document.getElementById('lyrics').addEventListener('input', function() {
            const vocalContainer = document.getElementById('vocal-generation-container');
            vocalContainer.style.display = this.value.trim() !== '' ? 'block' : 'none';
        });
    
        // Vocal generation function
        document.getElementById('generate-vocals-btn').addEventListener('click', async function() {
            const lyrics = document.getElementById('lyrics').value;
            const vocalStyle = document.getElementById('vocal-style').value || 'female_pop'; // Default style
            const vocalPresence = document.getElementById('vocal-presence')?.value || 50;
            const vocalReverb = document.getElementById('vocal-reverb')?.value || 30;
            
            // Disable button and show loading
            this.disabled = true;
            const originalText = this.innerHTML;
            this.innerHTML = '<span class="spinner"></span> Generating Vocals...';
            
            // Show processing status
            const status = document.getElementById('music-status');
            status.innerHTML = `
                <div><i class="fas fa-microphone"></i> Generating vocals for your lyrics...</div>
                <div class="progress-container">
                    <div class="progress-bar" id="vocal-progress-bar"></div>
                </div>
            `;
            status.className = 'status status-processing';
            status.style.display = 'block';
            
            try {
                // Call your vocal generation endpoint
                const response = await fetch('/generate_vocals', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lyrics: lyrics,
                        style: vocalStyle,
                        presence: vocalPresence,
                        reverb: vocalReverb
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Display the vocal results
                    const vocalPlayer = document.getElementById('vocal-player');
                    vocalPlayer.src = data.vocal_url;
                    document.getElementById('vocal-result-container').style.display = 'block';
                    
                    // Set download link
                    document.getElementById('download-vocals-btn').href = data.vocal_url;
                    document.getElementById('download-vocals-btn').download = 'generated_vocals.wav';
                    
                    // Update status
                    status.textContent = 'Vocals generated successfully!';
                    status.className = 'status status-success';
                    
                    // Scroll to results
                    setTimeout(() => {
                        document.getElementById('vocal-result-container').scrollIntoView({
                            behavior: 'smooth',
                            block: 'nearest'
                        });
                    }, 300);
                } else {
                    throw new Error(data.error || 'Error generating vocals');
                }
            } catch (error) {
                status.textContent = 'Vocal generation failed: ' + error.message;
                status.className = 'status status-error';
            } finally {
                // Reset button state
                this.disabled = false;
                this.innerHTML = originalText;
            }
        });
    
        // Mix tracks functionality
        document.getElementById('mix-tracks-btn').addEventListener('click', async function() {
            const instrumentalUrl = document.getElementById('audio-player').src;
            const vocalUrl = document.getElementById('vocal-player').src;
            
            this.disabled = true;
            this.innerHTML = '<span class="spinner"></span> Mixing...';
            
            try {
                const response = await fetch('/mix_tracks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        instrumental: instrumentalUrl,
                        vocals: vocalUrl
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update the main audio player with mixed version
                    document.getElementById('audio-player').src = data.mixed_url;
                    document.getElementById('download-music-btn').href = data.mixed_url;
                    
                    // Show success message
                    const status = document.getElementById('music-status');
                    status.textContent = 'Music and vocals mixed successfully!';
                    status.className = 'status status-success';
                } else {
                    throw new Error(data.error || 'Error mixing tracks');
                }
            } catch (error) {
                const status = document.getElementById('music-status');
                status.textContent = 'Mixing failed: ' + error.message;
                status.className = 'status status-error';
            } finally {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-sliders-h"></i> Mix With Music';
            }
        });
    </script>
</body>
</html>